<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Selskapsanalyse – AI-genererte rapporter</title>
  <meta name="description" content="Gratis AI-genererte selskapsrapporter med finansielle nøkkeltall, omdømme, nyheter og kunngjøringer." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .hero-bg:before { content:""; position:absolute; inset:0; background-image: radial-gradient(circle at 20% 10%, rgba(255,255,255,.15), transparent 35%), radial-gradient(circle at 80% 30%, rgba(255,255,255,.08), transparent 45%), radial-gradient(circle at 40% 80%, rgba(255,255,255,.10), transparent 35%); pointer-events:none; }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,1px,1px); white-space:nowrap; border:0; }
    pre code { white-space: pre; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">

  <!-- Hero -->
  <section class="relative hero-bg overflow-hidden min-h-screen flex items-center justify-center">
    <img src="https://images.unsplash.com/photo-1507679799987-c73779587ccf?auto=format&fit=crop&w=1920&q=80" alt="" class="absolute inset-0 -z-20 w-full h-full object-cover" />
    <div class="absolute inset-0 -z-10 bg-gradient-to-b from-emerald-50 via-cyan-50 to-white opacity-90"></div>
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20 sm:py-28 text-center">
      <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight leading-tight text-slate-900">
        Gratis <span class="bg-gradient-to-r from-emerald-500 to-cyan-500 bg-clip-text text-transparent">AI-genererte</span> analyser av norske selskaper
      </h1>
      <p class="mt-5 text-lg text-slate-600 max-w-2xl mx-auto">
        Vi bruker ChatGPT‑5 og avanserte algoritmer til å hente og analysere data fra Brønnøysundregistrene, sosiale medier og nyhetskilder – og presentere dem som komplette rapporter.
      </p>

      <!-- Search -->
      <form id="search" class="mt-8 flex flex-col sm:flex-row gap-3 justify-center" onsubmit="return goSearch(event)">
        <label for="q" class="sr-only">Søk etter selskap eller org.nr.</label>
        <input id="q" name="q" type="text" required placeholder="Søk etter selskap eller organisasjonsnummer…" class="w-full sm:w-96 rounded-2xl border border-slate-300 bg-white/80 px-4 py-3 shadow-sm focus:outline-none focus:ring-4 focus:ring-emerald-200 focus:border-emerald-400" />
        <button type="submit" class="inline-flex items-center justify-center rounded-2xl px-5 py-3 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-semibold shadow-lg hover:shadow-xl active:scale-[.99]">Analyser</button>
      </form>

      <div class="mt-3 text-sm text-slate-500">100% gratis å bruke – alltid oppdatert.</div>
    </div>
  </section>

  <!-- Datakilder -->
  <section class="py-12 bg-slate-100">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-xl sm:text-2xl font-extrabold">Datakilder</h2>
      <p class="mt-2 text-slate-600">Vår plattform kombinerer flere kilder for å gi deg full innsikt:</p>
      <div class="mt-8 grid sm:grid-cols-3 gap-6 text-left">
        <div class="p-6 bg-white rounded-2xl border border-slate-200 shadow-sm"><div class="font-semibold">Brønnøysundregistrene</div><p class="text-slate-600 mt-1">Offisielle selskapsdata og kunngjøringer.</p></div>
        <div class="p-6 bg-white rounded-2xl border border-slate-200 shadow-sm"><div class="font-semibold">Sosiale medier & nyheter</div><p class="text-slate-600 mt-1">Oppdatert omtale og sentimentanalyse.</p></div>
        <div class="p-6 bg-white rounded-2xl border border-slate-200 shadow-sm"><div class="font-semibold">ChatGPT‑5</div><p class="text-slate-600 mt-1">Genererer analyser og sammendrag som er enkle å forstå.</p></div>
      </div>
    </div>
  </section>

  <!-- Fordeler -->
  <section class="py-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-xl sm:text-2xl font-extrabold">Fordeler</h2>
      <p class="mt-2 text-slate-600">Spar tid på research, få helhetlig innsikt og oppdag muligheter raskere.</p>
    </div>
  </section>

  <!-- Resultater -->
  <section class="py-10 sm:py-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
      <div id="results" class="hidden">
        <h2 class="text-xl sm:text-2xl font-extrabold mb-4">Treff</h2>
        <ul id="company-list" class="list-disc pl-5 text-left space-y-1"></ul>
        <p id="hint" class="mt-4 text-sm text-slate-500"></p>
      </div>
    </div>
  </section>

  <!-- Hidden year target for script -->
  <div class="sr-only"><span id="year"></span></div>

  <!-- Dev docs: server proxy and .env -->
  <section class="px-4 sm:px-6 lg:px-8 py-10">
    <div class="max-w-5xl mx-auto">
      <h2 class="text-lg font-bold mb-3">server.js (proxy)</h2>
      <pre class="text-xs bg-slate-900 text-slate-100 p-4 rounded-xl overflow-auto"><code>// server.js - Node/Express proxy for Brønnøysund + Maskinporten (lukket)
// 1) npm init -y
// 2) npm i express node-fetch cors dotenv basic-auth jose
// 3) node server.js

import express from 'express';
import fetch from 'node-fetch';
import cors from 'cors';
import dotenv from 'dotenv';
import basicAuth from 'basic-auth';
import { SignJWT, importPKCS8 } from 'jose';
dotenv.config();

const app = express();
const PORT = process.env.PORT || 3001;

// Basic auth beskyttelse av API
const API_USER = process.env.PROXY_USER || 'oslotom';
const API_PASS = process.env.PROXY_PASS || 'oslotom';
app.use('/api', (req, res, next) => {
  const creds = basicAuth(req);
  if (!creds || creds.name !== API_USER || creds.pass !== API_PASS) {
    res.set('WWW-Authenticate', 'Basic realm="Access"');
    return res.status(401).send('Authentication required.');
  }
  next();
});

app.use(cors({ origin: process.env.CORS_ORIGIN || true }));

async function proxyJSON(url, init = {}) {
  const r = await fetch(url, { headers: { Accept: 'application/json' }, ...init });
  if (!r.ok) {
    const text = await r.text().catch(() => '');
    throw new Error(`Upstream ${r.status} on ${url}: ${text.slice(0, 200)}`);
  }
  return r.json();
}

// ===== Maskinporten (lukket API) =====
let cachedToken = null;
let cachedExp = 0;

async function getMaskinportenAccessToken() {
  const now = Math.floor(Date.now() / 1000);
  if (cachedToken && now &lt; cachedExp - 30) return cachedToken;

  const clientId = process.env.MP_CLIENT_ID;
  const tokenEndpoint = process.env.MP_TOKEN_ENDPOINT;
  const scope = process.env.MP_SCOPE;
  const privateKeyPem = process.env.MP_PRIVATE_KEY_PEM;

  if (!clientId || !tokenEndpoint || !scope || !privateKeyPem) {
    throw new Error('Maskinporten env vars mangler (MP_CLIENT_ID, MP_TOKEN_ENDPOINT, MP_SCOPE, MP_PRIVATE_KEY_PEM)');
  }

  const alg = 'RS256';
  const pk = await importPKCS8(privateKeyPem, alg);
  const nowMs = Date.now();

  const assertion = await new SignJWT({ scope })
    .setProtectedHeader({ alg })
    .setIssuer(clientId)
    .setSubject(clientId)
    .setAudience(tokenEndpoint)
    .setJti(cryptoRandom())
    .setIssuedAt(Math.floor(nowMs / 1000))
    .setExpirationTime(Math.floor(nowMs / 1000) + 120)
    .sign(pk);

  const form = new URLSearchParams();
  form.set('grant_type', 'urn:ietf:params:oauth:grant-type:jwt-bearer');
  form.set('assertion', assertion);

  const resp = await fetch(tokenEndpoint, {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: form
  });

  if (!resp.ok) {
    const text = await resp.text();
    throw new Error(`Maskinporten token feilet: HTTP ${resp.status} ${text}`);
  }
  const json = await resp.json();
  cachedToken = json.access_token;
  cachedExp = now + (json.expires_in || 120);
  return cachedToken;
}

function cryptoRandom() {
  return Math.random().toString(36).slice(2) + Date.now().toString(36);
}

// Åpne endepunkter
app.get('/api/enheter', async (req, res) => {
  try {
    const qs = new URLSearchParams({ ...req.query });
    const url = `https://data.brreg.no/enhetsregisteret/api/enheter?${qs.toString()}`;
    const json = await proxyJSON(url);
    res.json(json);
  } catch (e) {
    res.status(502).json({ error: e.message });
  }
});

app.get('/api/regnskap/:orgnr', async (req, res) => {
  try {
    const { orgnr } = req.params;
    const url = `https://data.brreg.no/regnskapsregisteret/regnskap/${orgnr}`;
    const json = await proxyJSON(url);
    res.json(json);
  } catch (e) {
    res.status(502).json({ error: e.message });
  }
});

// Lukket endepunkt (historikk)
app.get('/api/regnskap/:orgnr/historikk', async (req, res) => {
  try {
    const { orgnr } = req.params;
    const qs = new URLSearchParams({ ...req.query });
    const token = await getMaskinportenAccessToken();
    const url = `https://data.brreg.no/regnskapsregisteret/api/regnskap/${orgnr}?${qs.toString()}`;
    const json = await proxyJSON(url, { headers: { Authorization: `Bearer ${token}` } });
    res.json(json);
  } catch (e) {
    res.status(502).json({ error: e.message });
  }
});

app.listen(PORT, () => console.log(`Proxy running on http://localhost:${PORT}`));
</code></pre>

      <h3 class="text-sm font-semibold mt-6 mb-2">.env</h3>
      <pre class="text-xs bg-slate-900 text-slate-100 p-4 rounded-xl overflow-auto"><code>CORS_ORIGIN=http://localhost:3000
PORT=3001
PROXY_USER=oslotom
PROXY_PASS=oslotom
# ==== Maskinporten (fyll inn fra Digdir-oppsettet) ====
MP_CLIENT_ID=
MP_TOKEN_ENDPOINT=
MP_SCOPE=
MP_PRIVATE_KEY_PEM=-----BEGIN PRIVATE KEY-----
...
-----END PRIVATE KEY-----
</code></pre>
    </div>
  </section>

  <script>
    async function fetchJSON(url){
      const r = await fetch(url, { headers: { 'Accept': 'application/json' }});
      if(!r.ok) throw new Error(`HTTP ${r.status} on ${url}`);
      return r.json();
    }

    async function searchCompanies(query){
      const resEl = document.getElementById('results');
      const listEl = document.getElementById('company-list');
      const hintEl = document.getElementById('hint');
      resEl.classList.remove('hidden');
      listEl.innerHTML = '<li>Søker...</li>';
      hintEl.textContent = '';

      try {
        const searchUrl = `/api/enheter?navn=${encodeURIComponent(query)}&size=10`;
        const er = await fetchJSON(searchUrl);
        const hits = er?._embedded?.enheter || [];
        if(hits.length === 0){
          listEl.innerHTML = '<li>Ingen treff.</li>';
          hintEl.textContent = 'Tips: prøv eksakt firmanavn eller org.nr.';
          return;
        }
        listEl.innerHTML = hits.map(h =>
          `<li><a class="text-emerald-600 hover:underline" href="selskapsanalyse.html?orgnr=${h.organisasjonsnummer}">${h.navn} (${h.organisasjonsnummer})</a></li>`
        ).join('');
      } catch (e){
        listEl.innerHTML = `<li>Feil: ${e.message}</li>`;
      }
    }

    function goSearch(e){
      e.preventDefault();
      const q = document.getElementById('q').value.trim();
      if(!q) return false;
      searchCompanies(q);
      return false;
    }

    // Runtime asserts (enkle test cases)
    document.addEventListener('DOMContentLoaded', function(){
      console.assert(!!document.querySelector('section.hero-bg'), 'Hero section should exist');
      console.assert(!!document.getElementById('search'), 'Search form #search should exist');
      console.assert(!!document.getElementById('q'), 'Search input #q should exist');
      console.assert(!!document.getElementById('results'), '#results should exist');
      console.assert(Array.from(document.querySelectorAll('section')).some(s => s.textContent.includes('Datakilder')), 'Datakilder section should be present');
      var yearEl = document.getElementById('year');
      console.assert(!!yearEl, 'Hidden #year element should exist');
      if (yearEl) { yearEl.textContent = new Date().getFullYear(); }
    });
  </script>
</body>
</html>
